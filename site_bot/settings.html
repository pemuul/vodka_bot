<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сибирская лавка</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!--<link rel="stylesheet" href="css/style.css">-->
    <!--<link rel="stylesheet" href="css/dark_style.css">-->
    <!-- Подключение стилей (CSS) для оформления -->
</head>

<body>
    <div class="app" style="overflow-x: hidden;">
        <div class="container">
            <div class="modalSpienner" id="modalSpienner" style="display: none;"><span class="loader"></span></div>

            <!-- << ==================== ЗАКАЗЫ ==================== -->
            <div id="orders" class="tab tab_orders menu-div">
                <div class="tab_title">
                    <p>Заказы</p>
                </div>
                <div id="cart-orders" class="catalog catalog_rows item_length"></div>
            </div>

            <div id="order" style="display: none;" class="tab tab_main menu-div">
                <div id="cart-order" class="item_data order-list">
                    <p class="item_p margin_p">Заказ:
                    <p id="cart-order-no"></p>
                    </p>
                    <p class="item_p item_status">Статус:
                    <p id="cart-order-status"></p>
                    </p>
                    <p class="item_p">Создан:
                    <p id="cart-order-date"></p>
                    </p>
                </div>

                <div class="fixed_done_manipulator_order" style="display: flex;">
                    <img width="30px" src="icon/Ellipse 34.png" class="back___btn light_theme" alt=""
                        onclick="setMenuDiv('orders')">
                    <img width="30px" src="icon_white/Ellipse 34.png" class="back___btn dark_theme" alt=""
                        onclick="setMenuDiv('orders')">
                    <button id="send-message-btn" class="middle_add_btn">
                        <img width="20px" src="icon/Send.png" alt="" class="light_theme">
                        <img width="20px" src="icon_white/Send.png" alt="" class="dark_theme">
                        Написать клиенту
                    </button>
                    <img width="30px" style="opacity: 0;" src="icon/Group 46.png" alt="" class="right_arrow_btn">
                </div>
            </div>

            <div id="order-setting" style="display: none;" class="menu-div all-size">
                <h1>ЗАКАЗ РЕДАКТИРОВАНИЕ</h1>
                <button class="btn close-btn" onclick="setMenuDiv('orders')">
                    << Назад</button>
                        <div id="cart-order-setting"></div>
            </div>

            <div id="order-add-item" style="display: none;" class="menu-div tab tab_main">
                <div class="tab_title" style="margin-bottom: 5%;">
                    <p>Добавить товар к заказу</p>
                </div>

                <div id="cart-order-add-item" class="catalog"></div>

                <div class="fixed_done_manipulator_order" style="display: flex;">
                    <img width="30px" src="icon/Ellipse 34.png" class="back___btn light_theme" alt=""
                        onclick="setMenuDiv('order')">
                    <img width="30px" src="icon_white/Ellipse 34.png" class="back___btn dark_theme" alt=""
                        onclick="setMenuDiv('order')">

                    <button id="new-line-not-item" class="middle_add_btn">Новый товар</button>
                    <img width="30px" style="opacity: 0;" src="icon/Group 46.png" alt="" class="right_arrow_btn">
                </div>
            </div>

            <div id="order-edit-line" style="display: none;" class="tab tab_filter menu-div">
                <h2 class="headerSettings">Редактирование позиции</h2>
                <div id="cart-order-edit-line"></div>

                <div class="blockBtnBack" style="display: flex;">
                    <img style="margin-left: 6%;" width="30px" src="icon/Ellipse 34.png" class="back___btn light_theme"
                        alt="" onclick="setMenuDiv('order')">
                    <img style="margin-left: 6%;" width="30px" src="icon_white/Ellipse 34.png"
                        class="back___btn dark_theme" alt="" onclick="setMenuDiv('order')">
                </div>
            </div>

            <div id="order-send-message" style="display: none;" class="modal menu-div">
                <div id="cart-order-message" class="cart-order-message"></div>

            </div>
            <!-- >> ==================== ЗАКАЗЫ ==================== -->

            <!-- << ==================== ТОВАРЫ ==================== -->
            <div id="items" style="display: none;" class="tab tab_shopping menu-div">
                <div style="position: fixed; z-index: 11; bottom: 13%; right: 5%;">
                    <button class="addOpenModalMimiСircle" onclick="openEditProductCart(0)">
                        <img width="17px" src="icon/+.png">
                    </button>
                </div>
                <button id="create_product" class="addOpenModal">
                    <img src="icon/+.png">
                    Добавить товар
                </button>
                <div class="catalog" id="cart-items"></div>
            </div>

            <div id="item" style="display: none;" class="menu-div ">
                <div id="cart-item"></div>

                <!--<div class="fixed_done_manipulator_order" style="display: flex;">
                    <img width="30px" src="icon/Ellipse 34.png" class="back___btn " alt="" onclick="setMenuDiv('items')">
                    <button style="opacity: 0;" id="send-message" class="middle_add_btn">
                        <img width="20px" src="icon/Send.png" alt="">
                    </button>
                    <img width="30px" style="opacity: 0;" src="icon/Group 46.png" alt="" class="right_arrow_btn">
                </div>-->
            </div>

            <div id="item-setting" style="display: none;" class="menu-div all-size">
                <h1>ТОВАРЫ НАСТРОЙКА</h1>
                <button class="btn close-btn" onclick="setMenuDiv('items')">
                    << Назад</button>
                        <div id="cart-items-setting"></div>
            </div>
            <!-- >> ==================== ТОВАРЫ ==================== -->

            <!-- << =================== НАСТРОЙКИ ==================== -->
            <div id="settings" style="display: none;" class="tab tab_filter menu-div">
                <div class="catalog catalog_cart catalog_rows">
                    <section class="settings">
                        <h2 class="headerSettings">Настройки</h2>
                        <ul id="cart-settings">
                            <li><a href="#" id="settings-open-admins-btn" class="managers">- Настроить менеджеров</a>
                            </li>
                            <li><a href="#" id="settings-open-API-btn" class="fields" onclick="openSettingsFields()">-
                                    Настроить поля</a></li>
                            <li><a href="#" id="settings-open-site-btn" class="settings" onclick="openSettingsSite()">-
                                    Настройка сайта</a></li>
                            <li><a href="#" id="settings-open-API-btn" class="" style="display: none;"
                                    onclick="openSettingsAPI()">- Настройка API</a></li>
                            <li><a href="#" id="settings-open-pyment-btn" class="" style="display: none;"
                                    onclick="openSettingsPyment()">- Настройка оплаты</a></li>
                        </ul>
                    </section>
                </div>
            </div>

            <div id="settings-admins" style="display: none;" class="tab apspd menu-div">
                <h2 class="headerSettings">Настройка менеджеров</h2>
                <section class="managers container">
                    <div id="cart-setting-admins" class="managers"></div>
                </section>

                <div class="blockBtnBack" style="display: flex;">
                    <img style="margin-left: 6%;" width="30px" src="icon/Ellipse 34.png" class="back___btn light_theme"
                        alt="" onclick="setMenuDiv('settings')">
                    <img style="margin-left: 6%;" width="30px" src="icon_white/Ellipse 34.png"
                        class="back___btn dark_theme" alt="" onclick="setMenuDiv('settings')">
                </div>
            </div>

            <!--Добавить менеджера-->
            <div id="add-manager-form"
                style="display: none; background-color: rgba(0, 0, 0, 0.5); position: fixed; top: 0; left: 0; width: 100%; height: 100%; align-items: center; justify-content: center;">
                <div style="background-color: #fff; padding: 20px; border-radius: 8px; width: 400px;">
                    <h2>Добавить менеджера</h2>
                    <label for="name">Имя:</label>
                    <input type="text" id="name" style="width: 90%; padding: 10px; margin-bottom: 10px;">
                    <label for="id">ID:</label>
                    <input type="text" id="id" style="width: 90%; padding: 10px; margin-bottom: 10px;">
                    <label for="receive-messages">Получать сообщения:</label>
                    <input type="checkbox" id="receive-messages" style="margin-bottom: 10px;">
                    <label for="contact-feedback">Контакт для обратной связи:</label>
                    <input type="checkbox" id="contact-feedback" style="margin-bottom: 20px;">
                    <div style="text-align: right;">
                        <button id="save-manager" class="btnGreen">Сохранить</button>
                        <button id="cancel" class="btnRed">Отмена</button>
                    </div>
                </div>
            </div>

            <div id="settings-awaiting-payment" style="display: none;" class="tab zcx menu-div">
                <h2 class="headerSettings">Настройка полей</h2>
                <div id="cart-setting-awaiting-payment"></div>

                <div class="fixed_done_manipulator" style="padding-bottom: 4%;">
                    <img style="margin-left: 6%;" width="30px" src="icon/Ellipse 34.png" class="back___btn light_theme"
                        alt="" onclick="setMenuDiv('settings')">
                    <img style="margin-left: 6%;" width="30px" src="icon_white/Ellipse 34.png"
                        class="back___btn dark_theme" alt="" onclick="setMenuDiv('settings')">

                    <button id="add-awaiting-field" class="btn" style="margin: 0; padding: 2% 15%;">
                        <img style="width: 15px;" src="icon/Plus.png">
                        Добавить поле
                    </button>

                    <img width="30px" style="opacity: 0;" src="icon/Group 46.png" alt="" class="right_arrow_btn">
                </div>

            </div>

            <div id="setting-awaiting-field" style="display: none;" class="tab zcx menu-div">
                <h2 class="headerSettings">Настройка поля</h2>
                <div id="cart-setting-awaiting-field"></div>

                <div class="blockBtnBack" style="display: flex;">
                    <img style="margin-left: 6%;" width="30px" src="icon/Ellipse 34.png" class="back___btn light_theme"
                        alt="" onclick="setMenuDiv('settings-awaiting-payment')">
                    <img style="margin-left: 6%;" width="30px" src="icon_white/Ellipse 34.png"
                        class="back___btn dark_theme" alt="" onclick="setMenuDiv('settings-awaiting-payment')">
                </div>
            </div>

            <div id="settings-API" style="display: none;" class="menu-div all-size">
                <h2 class="headerSettings">Настройка API</h2>
                <div id="cart-setting-API"></div>

                <div class="blockBtnBack" style="display: flex;">
                    <img style="margin-left: 6%;" width="30px" src="icon/Ellipse 34.png" class="back___btn light_theme"
                        alt="" onclick="setMenuDiv('settings')">
                    <img style="margin-left: 6%;" width="30px" src="icon_white/Ellipse 34.png"
                        class="back___btn dark_theme" alt="" onclick="setMenuDiv('settings')">
                </div>
            </div>

            <div id="settings-site" style="display: none;" class="tab sad menu-div">
                <h2 class="headerSettings">Настройка сайта</h2>
                <div id="cart-setting-site"></div>
            </div>
            <!-- >> =================== НАСТРОЙКИ ==================== -->

            <!-- Нижний блок -->
            <nav id="bottom-block">
                <div class="container navig">
                    <ul id="menu-link" class="menu-link">
                        <li class="active">
                            <button id="orders-bottom-btn" class="btmMenu">
                                <i class="icon icon_orders"></i>
                            </button>
                        </li>
                        <li class="">
                            <button id="items-bottom-btn" class="btmMenu">
                                <i class="icon icon_shopping"></i>
                            </button>
                        </li>
                        <li class="">
                            <button id="settings-bottom-btn" class="btmMenu">
                                <i class="icon icon_filter"></i>
                            </button>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js "></script>

    <!-- Скрипт для логики и взаимодействия -->
    <script>
        function setBottom() {
            bottom_block_btn.style.display = 'flex';
        }

        function closeBottom() {
            bottom_block_btn.style.display = 'none';
        }

        function setMenuDiv(divIdToShow) {
            setBottom();

            var menuDivs = document.querySelectorAll('.menu-div'); // Получаем все div'ы с классом "menu-div"
            for (var i = 0; i < menuDivs.length; i++) {
                if (menuDivs[i].id === divIdToShow) {
                    menuDivs[i].style.display = 'block'; // Показываем div, если его id совпадает с переданным аргументом
                    if (menuDivs[i].classList.contains('all-size')) {
                        closeBottom();
                    }
                } else {
                    menuDivs[i].style.display = 'none'; // Скрываем остальные div'ы
                }
            }
        }
    </script>

    <!-- Скрипт для отображения активной кнопки в меню -->
    <script>
        $("#menu-link").on("click", "li", function () {
            $("#menu-link li").removeClass('active');
            $(this).addClass('active');
        });
    </script>

    <script>
        // ------- Нижние кнопки -------
        const bottom_block_btn = document.getElementById('bottom-block');
        const orders_bottom_btn = document.getElementById('orders-bottom-btn');
        const items_bottom_btn = document.getElementById('items-bottom-btn');
        const settings_bottom_btn = document.getElementById('settings-bottom-btn');

        // ------- Заказ -------
        const orders_div = document.getElementById('orders');
        const order_div = document.getElementById('order');
        const order_setting_div = document.getElementById('order-setting');
        const cart_order_div = document.getElementById('cart-order');
        const order_add_item = document.getElementById('order-add-item');
        const order_edit_line = document.getElementById('order-edit-line');

        // ------- Товары -------
        const items_div = document.getElementById('items');
        const item_div = document.getElementById('item');
        const item_setting_div = document.getElementById('item-setting');

        // ------- Настройка -------
        const settings_div = document.getElementById('settings');
        const settings_admins_div = document.getElementById('settings-admins');
        const settings_awaiting_payment_div = document.getElementById('settings-awaiting-payment');
        const settings_API_div = document.getElementById('settings-API');
        const settings_open_admins_btn = document.getElementById('settings-open-admins-btn');

        // ------- Получаем для запросов -------
        var currentURL = window.location.href;
        var urlWithoutParams = currentURL.split('?')[0];
        const urlTgParams = urlWithoutParams.split('#')[0];
        const DomainUrl = 'https://designer-tg-bot.ru/';


        // переменные глобальные
        var image_div_id = 0; // для понимания, какой див последний
        var imge_prew_len = 0;


        // ------- Обрабатываем нажатие кнопок -------
        orders_bottom_btn.addEventListener('click', () => {
            setMenuDiv('orders');
        });

        items_bottom_btn.addEventListener('click', () => {
            setMenuDiv('items');
        });

        settings_bottom_btn.addEventListener('click', () => {
            setMenuDiv('settings');
        });
    </script>

    <script>
        var tg = window.Telegram.WebApp;
        var color_theme = tg.colorScheme;
        tg.expand();

        const tg_id = tg.initDataUnsafe.user && tg.initDataUnsafe.user.id ? tg.initDataUnsafe.user.id : 1001;
        console.log('tg_id -->', tg_id);
        console.log('tg.colorScheme -->', tg.colorScheme);

        var head = document.getElementsByTagName('head')[0];
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        //светлая тема
        if (color_theme == "light") {
            link.href = 'css/style.css';
        }
        //темная тема
        if (color_theme == "dark") {
            link.href = 'css/dark_style.css';
        }
        head.appendChild(link);

    </script>

    <script>
        // ------- Настройка -------
        var admins_list;
        var awaiting_fields_list;

        document.getElementById('settings-open-admins-btn').addEventListener('click', async function () {
            await openSettingsAdmins();
        });


        async function getAdmins() {
            try {
                const response = await fetch(urlTgParams + '/get_admins', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: tg_id })//tg.initDataUnsafe.user.id }) // передача текста 'qwerqwqwe'
                });
                const data = await response.json();
                return data.admins; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных об администраторах:', error);
                return [];
            }
        }


        async function updateAdminRule(rule, should_add_it, edit_admin_id) {
            //alert(`Не реализованно updateAdminRule(${rule}, ${should_add_it})`); 
            try {
                const response = await fetch(urlTgParams + '/update_admin_rule', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: tg_id, add_rule: should_add_it, rule: rule, edit_admin_id: edit_admin_id })//tg.initDataUnsafe.user.id }) // передача текста 'qwerqwqwe'
                });
                const data = await response.json();
                return data.admins; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных о товарах:', error);
                return [];
            }
        }

        async function openSettingsAdmins() {
            // открываем меню настроек админов

            admins_list = await getAdmins();
            console.log(admins_list);

            const cart_setting_admins = document.getElementById('cart-setting-admins');
            cart_setting_admins.innerHTML = '';

            admins_list.forEach(admin => {
                console.log("АДМИНЫ -->>", admin)
                const adminsInfo = document.createElement('div');
                adminsInfo.innerHTML = `
                    <div class="manager" style="margin-bottom: 20px; border: 1px solid rgba(119, 119, 119, 0.2);padding: 5%;border-radius: 5px;">
                        <div class="manager-info" style="display: flex;">
                            <div class="details">
                                <p style="font-weight: 600; font-size: 14px;">${admin.user.name}</p>
                                <p>Получать сообщения: <input type="checkbox" id="admin-is-manager-${admin.user_tg_id}" ${admin.rule.includes('GET_INFO_MESSAGE') ? 'checked' : ''}></p>
                                <p>Контакт для обратной связи: <input type="checkbox" id="admin-is-contact-manager-${admin.user_tg_id}" ${admin.rule.includes('CONTACT_MANAGER') ? 'checked' : ''}></p>
                            </div>
                        </div>
                    </div>
                `;
                cart_setting_admins.appendChild(adminsInfo);

                document.getElementById(`admin-is-manager-${admin.user_tg_id}`).addEventListener('change', async function () {
                    await updateAdminRule('GET_INFO_MESSAGE', this.checked, admin.user_tg_id);
                });

                document.getElementById(`admin-is-contact-manager-${admin.user_tg_id}`).addEventListener('change', async function () {
                    await updateAdminRule('CONTACT_MANAGER', this.checked, admin.user_tg_id);
                });
            })

            setMenuDiv('settings-admins');
        }

        async function getAwaitingFields(type, field) {
            try {
                const response = await fetch(urlTgParams + '/get_awaiting_fields', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: tg_id })
                });
                const data = await response.json();
                return data.awaiting_fields; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных о товарах:', error);
                return [];
            }
        }

        async function updateAwaitingFields(type, field) {
            try {
                const response = await fetch(urlTgParams + '/update_awaiting_fields', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: tg_id, type: type, field: field })
                });
                const data = await response.json();
                return data.success; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных о товарах:', error);
                return [];
            }
        }

        async function getAwaitingField(field_no) {
            return awaiting_fields_list[field_no]
        }

        async function openSettingsFields() {
            awaiting_fields_list = await getAwaitingFields();

            const cart_setting_awaiting_payment = document.getElementById('cart-setting-awaiting-payment');
            cart_setting_awaiting_payment.innerHTML = '';

            ///cart_setting_awaiting_payment.innerHTML = `
            ///    <button class="addOpenModal" style="border-radius: 5px; padding: 2%;" id="add-awaiting-field">
            ///        <img style="width: 15px; margin-right: 2%" src="icon/+.png">
            ///        Добавить поле
            ///    </button>
            ///
            ///    <button id="add-awaiting-field" class="btn" style="margin: 0; padding: 2% 15%;" >
            ///        <img style="width: 15px; margin-right: 2%" src="icon/+.png">
            ///        Добавить поле
            ///    </button>
            ///`;

            var last_index = -1;
            awaiting_fields_list.map((awaiting_field, index) => {
                const awaiting_fieldInfo = document.createElement('div');
                awaiting_fieldInfo.innerHTML = `
                    <div class="fieldInfoBlock">
                        <div class="nameInputfieldInfo">
                            <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                            <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                            <label>Название</label>
                        </div>
                        <div class="textareaInput">
                            <p class="infoFieldBlock">${awaiting_field.name}</p>
                        </div>      
                        <div class="nameInputfieldInfo">
                            <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                            <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                            <label>Подсказка</label>
                        </div>
                        <div class="textareaInput">
                            <p class="infoFieldBlock">${awaiting_field.description}</p>
                        </div>      
                        <div class="nameInputfieldInfo">
                            <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                            <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                            <label>Тип</label>
                        </div>
                        <div class="textareaInput">
                            <p class="infoFieldBlock">${awaiting_field.type}</p>
                        </div>      
                        <button class="btn" style="border-radius: 5px;" id="edit-awaiting-field-${index}">
                            <img style="width: 20px;" src="icon/edit.png" class="light_theme">
                            <img style="width: 20px;" src="icon_white/edit.png" class="dark_theme">
                            Редактировать
                        </button>
                    </div>
                `;
                cart_setting_awaiting_payment.appendChild(awaiting_fieldInfo);

                document.getElementById(`edit-awaiting-field-${index}`).addEventListener('click', async function () {
                    await openSettingField(index);
                    setMenuDiv('setting-awaiting-field');
                });

                last_index = index;
            })

            document.getElementById(`add-awaiting-field`).addEventListener('click', async function () {
                awaiting_fields_list.push({
                    "id": "",
                    "name": "",
                    "description": "",
                    "type": "",
                    "placeholder": "",
                    "other": ""
                })

                await openSettingField(last_index + 1);
                setMenuDiv('setting-awaiting-field');
            });

            setMenuDiv('settings-awaiting-payment');
        }

        async function openSettingField(field_no) {
            // открываем настройку полей для ввода данных
            const awaiting_field = await getAwaitingField(field_no);

            const cart_setting_awaiting_payment = document.getElementById('cart-setting-awaiting-field');
            cart_setting_awaiting_payment.innerHTML = '';
            console.log('awaiting_field', awaiting_field);

            //awaiting_fields_list.forEach(awaiting_field => {
            const awaiting_fieldInfo = document.createElement('div');
            awaiting_fieldInfo.innerHTML = `
                <h2>Параметры поля</h2>
                <form id="form-setting-awaiting-field" enctype="multipart/form-data">
                    <input type="hidden" name="product_id" placeholder="ID поля, будет автоматически заполнено" value="${awaiting_field.id}" disabled>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label>Название поля</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" input type="text" name="product_name" placeholder="Введите названте поля" value="${awaiting_field.name}" required>
                    </div>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label>Описание поля</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" type="text" name="product_description" placeholder="Введите описание поля" value="${awaiting_field.description}" required>
                    </div>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label>Тип</label>
                    </div>
                    <div class="textareaInput">
                        <select class="inputCreateStyle" id="product_type" name="product_type" style="width: 100%;">
                            <option value="text" selected>Текст</option>
                            <option value="password">Пароль</option>
                            <option value="checkbox">Флажок</option>
                            <option value="number">Число</option>
                            <option value="email">Email</option>
                            <option value="url">URL</option>
                            <option value="date">Дата</option>
                        </select>
                    </div>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label>Подсказка</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" type="text" name="product_placeholder" placeholder="Введите подсказку поля" value="${awaiting_field.placeholder}" required>
                    </div>

                    <div class="textareaInput" style="opacity: 0;">
                        <input class="inputCreateStyle" type="hidden" name="product_other" placeholder="Введите что-то ещё" value="${awaiting_field.other}" required>
                    </div>

                    <div class="fixed_done_manipulator" style="padding-bottom: 4%;">
                        <img width="30px" src="icon/Ellipse 34.png" data-tab="main" class="delete-btn light_theme" alt="" onclick="setMenuDiv('settings')">
                        <img width="30px" src="icon_white/Ellipse 34.png" data-tab="main" class="delete-btn dark_theme" alt="" onclick="setMenuDiv('settings')">  

                        <button type="button" id="save-awaiting-fields-line" class="btn" style="margin: 0; padding: 2% 15%;" >
                            <img width="20px" src="icon/Save file.png" alt="" class="light_theme">
                            <img width="20px" src="icon_white/Save file.png" alt="" class="dark_theme">
                            Сохранить
                        </button>

                        <button type="button" id="delete-awaiting-field" class="btnTransparent">
                            <img width="30px" src="icon/Bin.png" alt="" class="light_theme">
                            <img width="30px" src="icon_white/Bin.png" alt="" class="dark_theme">
                        </button>
                    </div>

                </form>
            `;
            cart_setting_awaiting_payment.appendChild(awaiting_fieldInfo);

            document.getElementById(`delete-awaiting-field`).addEventListener('click', async function () {
                await deleteSettingsField(awaiting_field.id);
            });

            document.getElementById('save-awaiting-fields-line').addEventListener('click', async function (event) {
                //event.preventDefault(); 
                await saveSettingsField();
            });

            if (awaiting_field.type != '') {
                var product_type = document.getElementById('product_type');
                // Используем switch для установки атрибута selected в зависимости от значения order.status
                product_type.querySelector(`option[value="${awaiting_field.type}"]`).selected = true;
            }

            //document.getElementById(`admin-is-manager-${awaiting_field.user_id}`).addEventListener('change', async function() {                 
            //    await updateAdminRule('MANAGER', this.checked);
            //});
            //})

            setMenuDiv('settings-awaiting-payment');
        }

        async function deleteSettingsField(product_id) {
            var form = document.getElementById('form-setting-awaiting-field');
            var formData = {};

            formData['product_id'] = product_id

            await updateAwaitingFields('delete', formData);

            await openSettingsFields();
        }

        async function saveSettingsField() {
            //alert('Не реализованно saveSettingsField()');
            // для сохранения настройки полей 

            // получаем значение полей
            var form = document.getElementById('form-setting-awaiting-field');
            var formData = {};

            console.log('form -> ', form);

            // Получаем все элементы формы
            var elements = form.elements;

            // Проходимся по каждому элементу формы
            for (var i = 0; i < elements.length; i++) {
                var element = elements[i];
                // Проверяем, что элемент - текстовое поле (или другой тип поля ввода, который вам нужен)
                if (['INPUT', 'SELECT'].includes(element.tagName) && element.type !== 'button') {
                    // Добавляем значение поля в объект formData, используя имя поля в качестве ключа
                    formData[element.name] = element.value;
                }
            }

            // Выводим значения полей в консоль (вы можете сделать что-то еще с этими значениями)
            console.log('formData -> ', formData);

            // отправляем запрос на изменение
            await updateAwaitingFields('update', formData);

            // обновляем данные полей
            await openSettingsFields();
            // возвращаемся
            //setMenuDiv('settings-awaiting-payment');

        }

        async function getSettingsAPI(type, field) {
            try {
                const response = await fetch(urlTgParams + '/get_settings_API', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: tg_id })
                });
                const data = await response.json();
                return data.API_order_status; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных о товарах:', error);
                return [];
            }
        }

        async function openSettingsAPI() {
            // открываем настройку API
            const get_settings_API = await getSettingsAPI();

            const cart_setting_API = document.getElementById('cart-setting-API');
            cart_setting_API.innerHTML = '';

            //awaiting_fields_list.forEach(awaiting_field => {
            const setting_APIInfo = document.createElement('div');
            setting_APIInfo.innerHTML = `
                <form id="form-settings-API" enctype="multipart/form-data">
                    <h2>При создании заказа: </h2>
                    <h4>Ссылка: </h4>
                    <input type="text" name="settings_API_url_create" placeholder="API куда делать отправлять с запрос о создании заказа" value="${get_settings_API.create_order.API}" required>
                    <h4>Заголовок: </h4>
                    <input type="text" name="settings_API_header_create" placeholder="Заголовок API куда делать отправлять с запрос о создании заказа" value="${get_settings_API.create_order.header}" required>
                    <br>
                    <h2>При подтверждении оплаты:</h2>
                    <h4>Ссылка: </h4>
                    <input type="text" name="settings_API_url_pyment" placeholder="API куда делать отправлять с запрос о создании заказа" value="${get_settings_API.pyment_order.API}" required>
                    <h4>Заголовок: </h4>
                    <input type="text" name="settings_API_header_pyment" placeholder="Заголовок API куда делать отправлять с запрос о создании заказа" value="${get_settings_API.pyment_order.header}" required>
                    <br>
                    <h2>При окончании оплаты:</h2   >
                    <h4>Ссылка: </h4>
                    <input type="text" name="settings_API_url_sucsess" placeholder="API куда делать отправлять с запрос о создании заказа" value="${get_settings_API.sucess_pyment.API}" required>
                    <h4>Заголовок: </h4>
                    <input type="text" name="settings_API_header_sucsess" placeholder="Заголовок API куда делать отправлять с запрос о создании заказа" value="${get_settings_API.sucess_pyment.header}" required>
                    <button type="button" id="save-settings-API" class="btn">СОХРАНИТЬ</button>
                </form>
            `;
            cart_setting_API.appendChild(setting_APIInfo);

            document.getElementById(`save-settings-API`).addEventListener('click', async function () {
                await updateSettingsAPI();
                setMenuDiv('settings');
            });

            setMenuDiv('settings-API');
        }

        async function updateSettingsAPI() {
            var data_API_settings = {};
            var form_settings_API = document.getElementById('form-settings-API');

            // Получаем все элементы формы
            var elements = form_settings_API.elements;

            // Проходимся по каждому элементу формы
            for (var i = 0; i < elements.length; i++) {
                var element = elements[i];
                // Проверяем, что элемент - текстовое поле (или другой тип поля ввода, который вам нужен)
                if (element.tagName === 'INPUT' && element.type !== 'button') {
                    // Добавляем значение поля в объект formData, используя имя поля в качестве ключа
                    data_API_settings[element.name] = element.value;
                }
            }

            try {
                const response = await fetch(urlTgParams + '/update_settings_API', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: tg_id, API_settings: data_API_settings })
                });
                const data = await response.json();
                return data.success; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных о товарах:', error);
                return [];
            }
        }

        async function openSettingsPyment() {
            // Открываем форму для заполнения данных оплаты
            alert('Не реализованно openSettingsPyment');
        }
    </script>

    <script>

        // ------- Заказы -------
        async function getOrders() {
            try {
                const response = await fetch(urlTgParams + '/get_all_orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: tg_id })//tg.initDataUnsafe.user.id }) // передача текста 'qwerqwqwe'
                });
                const data = await response.json();
                return data.user_orders; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных о товарах:', error);
                return [];
            }
        }

        const getOrderByNo = (orderNo) => {
            console.log(orders_list);
            return orders_list.find(order => order.no === orderNo);
        };

        const getOrderDetailsByNo = (orderNo) => {
            console.log(orders_list);
            return orders_list.find(order => order.no === orderNo);
        };

        const orderContainer = document.getElementById('cart-orders');

        function openOrder() {
            alert('Не реализованно openOrder()');
        }

        async function addProduktToLine(order_no, product_id) {
            //alert('Не реализованно addProduktToLine()');
            // создаём строку в заказе с определённым товаром
            try {
                const response = await fetch(urlTgParams + '/add_item_to_order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: tg_id, order_no: order_no, product_id: product_id })//tg.initDataUnsafe.user.id }) // передача текста 'qwerqwqwe'
                });
                const data = await response.json();
                await renderOrders();
                createOrderElement(getOrderByNo(order_no));
                createOrderInfo(getOrderByNo(order_no));
                // возвращаемся на страницу заказа
                setMenuDiv('order');
                //return data.user_orders; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных о товарах:', error);
                return [];
            }
            // отправляем на сервер запрос на создание новой строки в заказе 

            // получаем заново заказы
        }

        async function saveOrderLine(order_no) {
            //alert('Не реализованно saveOrderLine()');
            // для создания строки в заказе без привязки к товару

            // проверяем введённаые данные на валидность
            const form_create_line = document.getElementById('form-create-line');
            const formData_create_line = new FormData(form_create_line);
            var data_create_line = {};

            formData_create_line.forEach((value, key) => {
                data_create_line[key] = value;
            });

            console.log(data_create_line);

            // отправляем запрос на создание строки
            try {
                const response = await fetch(urlTgParams + '/add_line', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: tg_id,
                        order_no: order_no,
                        product_id: form_create_line.elements['product_id'].value,
                        name: data_create_line['product_name'],
                        description: data_create_line['product_description'],
                        price: getPriceToSend(data_create_line['product_price']),
                        quantity: data_create_line['quantity']
                    })//tg.initDataUnsafe.user.id }) // передача текста 'qwerqwqwe'
                });
                const data = await response.json();
                await renderOrders();
                createOrderElement(getOrderByNo(order_no));
                createOrderInfo(getOrderByNo(order_no));
                // возвращаемся на страницу заказа
                setMenuDiv('order');
                //return data.user_orders; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных о товарах:', error);
                return [];
            }

            // заново получаем все заказы в базе

            // возвращаемся на карточку товара 
            //setMenuDiv('order');

        }

        async function createLineNoItem(order_no) {
            const cart_order_edit_line = document.getElementById('cart-order-edit-line');
            cart_order_edit_line.innerHTML = '';

            const lineInfo = document.createElement('div');
            lineInfo.innerHTML = `
                <form id="form-create-line" enctype="multipart/form-data">

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label >Заказ</label>
                    </div>
                    <div class="textareaInput">
                        <p class="infoFieldBlock">${order_no}</p>
                    </div>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label >Номер товара</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" type="text" name="product_id" placeholder="Номер товара, если нету - 0" value="0" disabled>
                    </div>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label >Описание поля</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" type="text" name="product_name" placeholder="Введите название товара"  required>
                    </div>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label >Описание</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" type="text" name="product_description" placeholder="Введите описание товара"  required>
                    </div>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label >Цена за штуку</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" type="text" name="product_price" placeholder="&#8381"  required>
                    </div>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label >Колличество</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" type="number" name="quantity" min="0" max="10000" step="1" value="1" placeholder="Введите количество товара">
                    </div>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label >Скидка</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" type="number" name="discount" min="0" max="100" step="0.01" value="0" placeholder="%">
                    </div>

                    
                    <div class="fixed_done_manipulator" style="padding-bottom: 4%;">
                        <img width="30px" src="icon/Ellipse 34.png" data-tab="main" class="delete-btn light_theme" alt="" onclick="setMenuDiv('order')">
                        <img width="30px" src="icon_white/Ellipse 34.png" data-tab="main" class="delete-btn dark_theme" alt="" onclick="setMenuDiv('order')">  

                        <button type="button" id="save-order-line" class="btn" style="margin: 0; padding: 2% 15%;" >
                            <img width="20px" src="icon/Save file.png" alt="" class="light_theme">
                            <img width="20px" src="icon_white/Save file.png" alt="" class="dark_theme">
                            Сохранить
                        </button>

                        <img width="30px" style="opacity: 0;" src="icon/Group 46.png" alt="" class="right_arrow_btn">
                    </div>
                </form>
            `;
            lineInfo.classList.add('order-line');
            cart_order_edit_line.appendChild(lineInfo);

            //cart_order_edit_line.innerHTML += `<button id="save-order-line" class="btn">СОХРАНИТЬ</button>`;

            document.getElementById('save-order-line').addEventListener('click', async function (event) {
                //event.preventDefault(); 
                await saveOrderLine(order_no);
            });

            setMenuDiv('order-edit-line');
        }

        async function selectItem(order_no) {
            // если мы хотим добавить товар или услугу, то нужна эта функция
            // у нас отурывается форма, где мы можем добавить любой товар или нажать на кнопку добавить ручное
            //   если добавить ручное, то мы открываем форму с пустой строкой, где заполним всё сами

            const products = await fetchProducts();

            const cart_order_add_item = document.getElementById('cart-order-add-item');
            cart_order_add_item.innerHTML = ''; // Очистка содержимого перед добавлением новых товаров

            //cart_order_add_item.innerHTML += `<button id="new-line-not-item" class="btn">Добавить строку без товара</button>`;


            products.forEach(product => {
                const productElement = document.createElement('div');
                productElement.classList.add('item');
                productElement.setAttribute('id', `product-${product.id}`); // Установка ID для каждой карточки товара
                var price = parseFloat(product.price) / 100;
                let old_price_vivble = product.discount != 0

                productElement.innerHTML = `
                    <div class="item_image">
                        <div class="picture_slide_box">
                            <img height="100%" width="60%" src="${DomainUrl}${product.media_list[0]}" alt="${product.name}">
                        </div>
                    </div>
                    <div class="item_data">
                        <div class="item_meta">
                            <div class="item_prices">
                                <p class="price">${getPriceDec(getNormalPrice(product.price, product.discount))} &#8381;</p>
                                <p class="old_price" style="display: ${old_price_vivble ? 'block' : 'none'};">${getPriceDec(product.price)} &#8381;</p>
                            </div>
                            <div class="item_stock">
                                <span>${product.quantity}</span> шт
                            </div>
                        </div>
                        <p class="item_title" style="margin: 0">${product.name}</p>
                        <button type="button" class="btn addToCart" id="add-item-to-line-${product.id}"><img width="10px" src="icon/Plus.png" alt=""> Добавить</button>
                    </div>
                `;

                cart_order_add_item.appendChild(productElement);

                document.getElementById(`add-item-to-line-${product.id}`).addEventListener('click', async function () {
                    await addProduktToLine(order_no, product.id);
                });


            });

            document.getElementById('new-line-not-item').addEventListener('click', async function () {
                await createLineNoItem(order_no);
            });

            setMenuDiv('order-add-item');
        }

        function checkStyleStatus(status) {
            let spanStatus = '';

            switch (status) {
                case 'NEW':
                    spanStatus = '<span class="badge" style="background-color: #559A53">Новый</span>';
                    break;
                case 'REQUIRES_CONFIRM_MENAGER':
                    spanStatus = '<span class="badge" style="background-color: #D75126; ">Ожидает подтверждения менeджера</span>';
                    break;
                case 'NEED_PAYMENTS':
                    spanStatus = '<span class="badge" style="background-color: #D29B0C">Ожидает оплаты</span>';
                    break;
                case 'PAYMENT_SUCCESS':
                    spanStatus = '<span class="badge" style="background-color: #366335">Оплачен</span>';
                    break;
                case 'ASSEMBLING':
                    spanStatus = '<span class="badge" style="background-color: #535753">Собирается</span>';
                    break;
                case 'SENT':
                    spanStatus = '<span class="badge" style="background-color: #4D7396">Отправлен</span>';
                    break;
                case 'READY_TO_ISSUDE':
                    spanStatus = '<span class="badge" style="background-color: #923719">Готов к выдаче</span>';
                    break;
                case 'COMPLETED':
                    spanStatus = '<span class="badge" style="background-color: #7b7e7b">Завершён</span>';
                    break;
                case 'CANCEL':
                    spanStatus = '<span class="badge" style="background-color: #353635">Отменён</span>';
                    break;
            }
            return spanStatus;
        }


        function createOrderElement(order) {
            const orderDiv = document.createElement('div');
            orderDiv.classList.add('item');

            const orderImg = document.createElement('div');
            orderImg.classList.add('item_image');
            if (order.lines) {
                orderImg.innerHTML = `
                    <div class="picture_slide_box_catalog">
                        <img style="max-height: 100%; max-width: 100%" src="${order.lines[0].item[0].media_list[0]}" alt="">
                    </div>
                    <div class="number_orders"><b>${order.lines.length}</b>шт</div>
                `;
            }

            const orderInfo = document.createElement('div');
            orderInfo.classList.add('item_data')
            //console.log(checkStyleStatus(order.status).toString());
            orderInfo.innerHTML = `
                <p class="item_p margin_p">Заказ: ${order.no}</p>
                <p class="item_p margin_p">Пользователь ID: ${order.client_id}</p>
                <p class="item_p item_status">Статус: ${checkStyleStatus(order.status)}</p>
                <p class="item_p">Создан: ${order.create_dt}</p>
            `;
            // <p class="item_p item_status">Статус: <span class="badge badge_green">${order.status}</span></p>
            orderInfo.classList.add('order-info');

            orderDiv.appendChild(orderImg);
            orderDiv.appendChild(orderInfo);


            orderDiv.addEventListener('click', () => {
                createOrderInfo(order);

                setMenuDiv('order');
            });


            return orderDiv;
        }

        function createOrderInfo(order) {
            cart_order_div.innerHTML = ''; // Очистка содержимого перед добавлением новых товаров

            const orderDetails = document.createElement('div');
            orderDetails.classList.add('product');

            var awaitingFields = `
                <h3 class="info_goods">Информация о заказе</h3>
                <hr>
            `;

            console.log(order);
            var additional_fields_list = order.additional_fields;

            for (let key in additional_fields_list) {
                if (additional_fields_list.hasOwnProperty(key)) {
                    let additional_fields_data = additional_fields_list[key];
                    console.log("Ключ: " + key + ", Значение: " + additional_fields_data);
                    awaitingFields += `
                        <div class="infoFieldBlockOrder">
                            <p>${additional_fields_data.description}</p>
                            <div class="arrow_txt">
                                <img src="icon/Line 15.png" alt="" class="light_theme_arrow">
                                <img src="icon_white/Line 15.png" alt="" class="dark_theme_arrow">
                                <p>${additional_fields_data.value}</p>
                            </div>
                        </div>
                    `;
                }
            }

            orderDetails.innerHTML = `
                <div class="order" style="display: flex; flex-direction: column;">
                    <div class="back_ordernum_box">
                        <p>Заказ: <strong>${order.no}</strong></p>
                    </div>  
                    <div class="starus_create_block">
                        <div class="create_elem" style="padding-bottom: 2%;">
                            <p class="left_width">Статус:</p>
                            <p class="date_create">${checkStyleStatus(order.status)}</p>
                        </div>
                        <div class="status_elem">
                            <p class="left_width">Выбрать статус:</p>
                            <select id="selectStatusList" class="status_color">
                                <option value="NEW">Новый</option>
                                <option value="REQUIRES_CONFIRM_MENAGER">Ожидает подтверждения менеджера</option>
                                <option value="NEED_PAYMENTS">Ожидает оплаты</option>
                                <option value="PAYMENT_SUCCESS">Оплачен</option>
                                <option value="ASSEMBLING">Собирается</option>
                                <option value="SENT">Отправлен</option>
                                <option value="READY_TO_ISSUDE">Готов к выдаче</option>
                                <option value="COMPLETED">Завершён</option>
                                <option value="CANCEL">Отменён</option>
                            </select>
                        </div>
                        <div class="create_elem" style="padding-bottom: 2%;">
                            <p class="left_width">Создано:</p>
                            <p class="date_create">${order.create_dt}</p>
                        </div>
                        <div class="paid create_elem">
                            <label for="paid">Оплачен:</label>
                            <input type="checkbox" id="is_paid_for" name="is_paid_for" ${order.is_paid_for ? 'checked' : ''}>
                        </div>
                    </div>      
                    <div class="products" style="margin-bottom: 20px;">
                        <h3 class="goods_text">Товары</h3>
                        <hr>

                    </div>
                </div>
            `;

            console.log(order.lines);
            if (order.lines && order.lines.length > 0) {
                order.lines.forEach(line => {
                    const lineItem = document.createElement('div');
                    //lineItem.classList.add('order-item');
                    lineItem.classList.add('itemInfoPositionOrder');
                    lineItem.innerHTML = '';
                    if (line.item[0]) {
                        if (line.item[0].media_list) {

                            lineItem.innerHTML = `
                                <div class="left_block_bg_">
                                    <img style="max-width: 100%; max-height:100%" src="${line.item[0].media_list[0]}" alt="">
                                </div>`
                        }
                    }
                    lineItem.innerHTML += `
                        <div class="right_block_txt">
                            <p>ID товара: ${line.item_id}</p>
                            <p>Кол-во:${line.quantity}шт.</p>
                            <p>Стоимость:${getPriceDec(line.price)} ₽</p>
                            <button id="edit-line-${line.id}" class="btn btn_inline" style="margin-bottom: 6%;">Изменить</button>
                        </div> 
                    `;
                    orderDetails.appendChild(lineItem);
                });
            };



            orderDetails.innerHTML += `        
                <button id="new-item" class="btnAddManager" ">
                    <img src="icon/Plus.png">Добавить товар 
                </button>`;

            //orderDetails.addEventListener("mousedown", function(event) {
            //    event.preventDefault();
            //});
            orderDetails.innerHTML += awaitingFields;

            //orderDetails.innerHTML += `<button id="send-message-btn" class="btn">Написать письмо клиенту</button>`;

            cart_order_div.appendChild(orderDetails);

            if (order.lines && order.lines.length > 0) {
                order.lines.forEach(line => {
                    document.getElementById(`edit-line-${line.id}`).addEventListener('click', async function () {
                        await openEditLite(order.no, line);
                    });
                });
            }

            document.getElementById('is_paid_for').addEventListener('click', async function () {
                var is_paid_for = order.is_paid_for ? true : false;
                console.log(order.is_paid_for, is_paid_for);
                if (is_paid_for) {
                    is_paid_for = order.is_paid_for == 1;
                }
                is_paid_for = !is_paid_for;
                //is_paid_for = true;
                await sendEditPaidFor(order.no, is_paid_for);
            });

            var selectStatusList = document.getElementById('selectStatusList');
            var orderStatus = order.status;

            // Используем switch для установки атрибута selected в зависимости от значения order.status
            selectStatusList.querySelector(`option[value="${order.status}"]`).selected = true;

            document.getElementById('new-item').addEventListener('click', async function () {
                await selectItem(order.no);
            });

            document.getElementById('send-message-btn').addEventListener('click', async function () {
                await render_message_form(order);
                setMenuDiv('order-send-message');
            });

            const select_status_list = orderDetails.querySelector('#selectStatusList');

            // Добавляем обработчик события change
            select_status_list.addEventListener('change', function (event) {
                const selectedValue = event.target.value;
                // Выполняем запрос с выбранным значением
                //makeRequest(selectedValue);
                console.log(selectedValue);
                // нужно отправить изменения на сервер
                updateOrderStatus(order.no, selectedValue);
                // Получаем обновление данных
            });

            setMenuDiv('order');
        }

        async function sendEditPaidFor(order_no, is_paid_for) {
            try {
                const currentPageUrl = urlTgParams + '/edit_paid_for';
                const response = await fetch(currentPageUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: tg_id, order_no: order_no, is_paid_for: is_paid_for })//tg.initDataUnsafe.user.id }) // передача текста 'qwerqwqwe'
                });
                const data = await response.json();
                await renderOrders();
                createOrderElement(getOrderByNo(order_no));
                createOrderInfo(getOrderByNo(order_no));

                return data.success; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных о товарах:', error);
                return [];
            }
        }

        async function render_message_form(order) {
            const message_form = document.getElementById('cart-order-message');
            message_form.innerHTML = '';

            //const message_form_div = document.createElement('div');
            message_form.innerHTML = `
                <form id="form-message-order" enctype="multipart/form-data" class="modal-content" style="height: 100vw; box-shadow: none;">
                    <h3 class="headerSettings">Сообщение по заказу: <p style="margin: 0 2%; font-weight: 600;">${order.no}</p></h3>
                    <div class="nameInput">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label >Текст сообщения</label>
                    </div>
                    <div class="textareaInput">
                        <textarea class="inputCreateStyle" type="text" name="text" id="message_text_order" placeholder="Введите текст сообщения" rows="10"></textarea>
                    </div>

                    <div class="fixed_done_manipulator_order" style="display: flex;">
                        <img width="30px" src="icon/Ellipse 34.png" class="back___btn light_theme" alt=""
                            onclick="setMenuDiv('order')">
                        <img width="30px" src="icon_white/Ellipse 34.png" class="back___btn dark_theme" alt=""
                            onclick="setMenuDiv('order')">

                        <button type="button" id="send-message" class="middle_add_btn">
                            <img width="20px" src="icon/Send.png" alt="" class="light_theme">
                            <img width="20px" src="icon_white/Send.png" alt="" class="dark_theme">
                            Отправить
                        </button>
                        <img width="30px" style="opacity: 0;" src="icon/Group 46.png" alt="" class="right_arrow_btn">
                    </div>
                </form>
            `;

            //message_form.appendChild(message_form_div);

            document.getElementById('send-message').addEventListener('click', async function () {
                const form_message_order = document.getElementById("form-message-order");
                //const formData = new FormData(form_message_order);
                var message_text = form_message_order.elements['message_text_order'].value;
                console.log("message_text ---- > ", message_text);
                console.log("order.no ---- > ", order.no);
                console.log("tg_id ---- > ", tg_id);
                await sendOrderMessage(order.no, message_text);
            });
        }

        async function sendOrderMessage(order_no, message) {
            try {
                const currentPageUrl = urlTgParams + '/send_message';
                const response = await fetch(currentPageUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: tg_id, order_no: order_no, message: message })
                });
                const data = await response.json();
                setMenuDiv('order');

                return data.success; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных о товарах:', error);
                return [];
            }
        }

        async function openEditLite(order_no, line) {
            // открываем форму для редактирования строки
            const cart_order_edit_line = document.getElementById('cart-order-edit-line');
            cart_order_edit_line.innerHTML = '';

            const lineInfo = document.createElement('div');
            console.log('line', line);
            lineInfo.innerHTML = `
                <form id="form-create-line" enctype="multipart/form-data">

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label >Заказ</label>
                    </div>
                    <div class="textareaInput">
                        <p class="inputCreateStyle" style="font-size: 16px;"><strong>${order_no}</strong></p>
                    </div>
                    
                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label >Строка</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" type="text" name="line_id" placeholder="Строка" value="${line.id}" disabled>
                    </div>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label >Номер товара</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" type="text" name="product_id" placeholder="Номер товара, если нету - 0" value="${line.item_id}" disabled>
                    </div>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label >Описание поля</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" type="text" name="product_name" placeholder="Введите название товара"  value="${line.name}" required>
                    </div>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label >Описание</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" type="text" name="product_description" placeholder="Введите описание товара" value="${line.description}" required>
                    </div>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label>Цена за штуку</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" type="text" name="product_price" placeholder="Введите цену товара" step="0.01" value="${getPriceDec(line.price)}"  required>
                    </div>

                    <div class="nameInputfieldInfo">
                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                        <label >Количество</label>
                    </div>
                    <div class="textareaInput">
                        <input class="inputCreateStyle" type="number" name="quantity" min="0" max="10000" step="0.01" value="${line.quantity}" placeholder="&#8381">
                    </div>

                    <div class="fixed_done_manipulator" style="padding-bottom: 4%;">
                        <img width="30px" src="icon/Ellipse 34.png" data-tab="main" class="delete-btn light_theme" alt="" onclick="setMenuDiv('order')">
                        <img width="30px" src="icon_white/Ellipse 34.png" data-tab="main" class="delete-btn dark_theme" alt="" onclick="setMenuDiv('order')">  

                        <button type="button" id="save-edit-line" class="btn" style="margin: 0; padding: 2% 15%;" >
                            <img width="20px" src="icon/Save file.png" alt="" class="light_theme">
                            <img width="20px" src="icon_white/Save file.png" alt="" class="dark_theme">
                            Сохранить
                        </button>

                        <button type="button" id="delete-edit-line" class="btnTransparent">
                            <img width="30px" src="icon/Bin.png" alt="" class="light_theme">
                            <img width="30px" src="icon_white/Bin.png" alt="" class="dark_theme">
                        </button>
                    </div>
                </form>
            `;
            lineInfo.classList.add('order-line');
            cart_order_edit_line.appendChild(lineInfo);

            //cart_order_edit_line.innerHTML += `<button id="save-order-line" class="btn">СОХРАНИТЬ</button>`;

            document.getElementById('save-edit-line').addEventListener('click', async function (event) {
                //event.preventDefault(); 
                await saveEditLine(order_no);
            });

            document.getElementById('delete-edit-line').addEventListener('click', async function (event) {
                //event.preventDefault(); 
                await deleteEditLine(line.id, order_no);
            });

            setMenuDiv('order-edit-line');
        }

        async function saveEditLine(order_no) {
            const form_create_line = document.getElementById('form-create-line');
            console.log(form_create_line)
            const formData_create_line = new FormData(form_create_line);
            var data_create_line = {};
            const elements = form_create_line.elements; // Получаем все элементы формы

            for (let i = 0; i < elements.length; i++) {
                const element = elements[i];
                if (element.name) {  // Проверяем, что у элемента есть имя
                    data_create_line[element.name] = element.value;
                }
            }

            console.log(data_create_line);

            // отправляем запрос на создание строки
            //try {
            const response = await fetch(urlTgParams + '/edit_line', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user_id: tg_id,
                    line_id: data_create_line['line_id'],
                    name: data_create_line['product_name'],
                    description: data_create_line['product_description'],
                    price: getPriceToSend(data_create_line['product_price']),
                    quantity: data_create_line['quantity']
                })//tg.initDataUnsafe.user.id }) // передача текста 'qwerqwqwe'
            });
            const data = await response.json();
            await renderOrders();
            createOrderElement(getOrderByNo(order_no));
            createOrderInfo(getOrderByNo(order_no));
            // возвращаемся на страницу заказа
            setMenuDiv('order');
            //return data.user_orders; // Предполагается, что ваш API возвращает массив товаров
            //} catch (error) {
            //    console.error('Ошибка при получении данных о товарах:', error);
            //    return [];
            //}
        }

        async function deleteEditLine(line_id, order_no) {
            const response = await fetch(urlTgParams + '/delete_line', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user_id: tg_id,
                    line_id: line_id
                })//tg.initDataUnsafe.user.id }) // передача текста 'qwerqwqwe'
            });

            await renderOrders();
            createOrderElement(getOrderByNo(order_no));
            createOrderInfo(getOrderByNo(order_no));
            setMenuDiv('order');
        }

        async function sendIssueInvoice(order_no) {
            const response = await fetch(urlTgParams + '/send_issue_invoice', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ user_id: tg_id, order_no: order_no })//tg.initDataUnsafe.user.id }) // передача текста 'qwerqwqwe'
            });
            const data = await response.json();
            updateOrderStatus(order_no, 'NEED_PAYMENTS');
            await renderOrders();
            createOrderElement(getOrderByNo(order_no));
            createOrderInfo(getOrderByNo(order_no));
            return data.success; // Предполагается, что ваш API возвращает массив товаров
        }

        async function updateOrderStatus(order_no, status) {
            //alert(`Не реализованно updateAdminRule(${rule}, ${should_add_it})`); 
            try {
                const response = await fetch(urlTgParams + '/update_order_status', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: tg_id, order_no: order_no, status: status })//tg.initDataUnsafe.user.id }) // передача текста 'qwerqwqwe'
                });
                const data = await response.json();
                renderOrders();
                return data.success; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных о товарах:', error);
                return [];
            }
        }

        function openEditOrder(orderNo) {
            var order = getOrderDetailsByNo(orderNo);

            setMenuDiv('order-setting');
        }

        async function renderOrders() {
            orders_list = await getOrders();
            console.log(orders_list);
            orderContainer.innerHTML = '';
            orders_list.forEach(order => {
                const orderElement = createOrderElement(order);
                orderContainer.appendChild(orderElement);
            });
        }

        var orders_list;

        renderOrders();

    </script>

    <script>
        function reloadImages() {
            const images = document.querySelectorAll('img'); // Находим все изображения

            images.forEach((img) => {
                const currentSrc = img.src; // Сохраняем текущий src
                // Обновляем src, добавляя временную метку
                if (currentSrc.slice(0, 4) != 'blob') {
                    img.src = currentSrc.split('?')[0] + '?t=' + new Date().getTime();
                }
            });
        }
        // ------- Товары -------
        const getProductByNo = (product_no) => {
            console.log(products);
            var product = products.find(product => product.id === product_no);
            if (!product) {
                product = {
                    id: '0',
                    media_list: [],
                    name: '',
                    description: '',
                    price: 0,
                    quantity: 0,
                    discount: 0,
                    requires_confirm_menager: false,
                    activ: true
                }
            }
            return product;
        };

        async function fetchProducts() {
            try {
                const currentPageUrl = urlTgParams + '/get_all_items';
                const response = await fetch(currentPageUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: tg_id })//tg.initDataUnsafe.user.id }) // передача текста 'qwerqwqwe'
                });
                const data = await response.json();
                return data.items; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных о товарах:', error);
                return [];
            }
        }

        async function saveProduct(order_no) {
            //alert('Не реализованно saveProduct()');

            //const formData = new FormData(

            const form_product = document.getElementById("form-edit-product");
            console.log(form_product);
            const form_images = document.getElementById("media_list_container");
            const formData = new FormData(form_product);
            //const fileInput = document.querySelector('input[type="file"]');
            const fileInputs = document.querySelectorAll('input[type="file"]');
            //const fileInputs = document.querySelectorAll('input[name="photos"]');
            // Перебираем все выбранные файлы и добавляем их в formData
            fileInputs.forEach((fileInput, index) => {
                for (const file of fileInput.files) {
                    formData.append('files[]', file);
                    console.log(fileInput.files);
                }
            });
            var product_id = form_product.elements['product_id'].value;
            formData.append('product_id', product_id);
            console.log("form_product.elements ---> ", form_product)
            // Выбираем все элементы img с классом previePhoto
            const images = form_product.querySelectorAll('.previePhoto');

            // Пробегаем по каждому элементу и собираем значения атрибута src
            const imageUrls = Array.from(images).map(img => img.src);
            console.log('imageUrls -> ', imageUrls);
            formData.append('media_list', imageUrls);
            //formData['product_activ'] = 'ok'//form_product.elements['product_activ'].value == 'on';
            formData.append('user_id', tg_id);
            //console.log('old_image_url -> ', imageOldUrls);

            // Получаем все изображения с классом previePhotoMin
            const allImages = document.querySelectorAll('.previePhotoMin');

            // Извлекаем названия файлов из атрибутов data-filename
            const allImagesFilenames = Array.from(allImages).map(img => img.getAttribute('data-filename'));

            // Добавляем названия файлов в FormData
            allImagesFilenames.forEach((filename) => {
                formData.append('all_images_url[]', filename); // Используем `[]` для указания, что это массив
            });
            //console.log('all_images_url -> ', allImagesUrls);

            let spinner = document.getElementById('modalSpienner');
            spinner.style.display = 'flex';

            const response = await fetch(urlTgParams + '/save_item', {
                method: 'POST',
                body: formData
            });

            // Обработка ответа
            const data = await response.json();
            spinner.style.display = 'none';
            //return data.success;
            // для создания строки в заказе без привязки к товару

            // проверяем введённаые данные на валидность

            // отправляем запрос на создание строки

            // заново получаем все заказы в базе

            // возвращаемся на карточку товара 
            setMenuDiv('items');

        }

        function getNormalPrice(price, discount) {
            const discountedPrice = price - (price * discount / 100);
            const endPrice = discountedPrice;

            return endPrice.toFixed(2); // Округляем до двух знаков после запятой
        }

        function getPriceDec(price) {
            return price / 100;
        }

        function getPriceToSend(price) {
            return Math.round(price * 100);
        }

        async function openEditProductCart(product_no) {
            const cart_item = document.getElementById('cart-item');
            cart_item.innerHTML = '';

            const product_by_no = getProductByNo(product_no);
            console.log('product_by_no -->', product_by_no);
            console.log('product_by_no.display_priority', product_by_no.display_priority)
            if (product_by_no.display_priority == null) {
                product_by_no.display_priority = 0;
            }

            const productInfo = document.createElement('div');
            productInfo.innerHTML = `
        <div id="myModal" >
            <div class="modal-content" style="height: 100%;">
                <div class="container">
                        <div class="product-id">
                            <h2 class="headerSettings">Товар:
                                <span style="font-weight: 600;">${product_by_no.id}</span>
                            </h2>
                        </div>
                        <form id="form-edit-product" enctype="multipart/form-data">

                        <div class="photo-upload-container" style="position: relative;">
                            <div id="photos_div" class="photos_div">
                                <input class="active-file" type="file" name="photos" id="fileInput_0" data-id="0" multiple>  
                            </div>
                             <label class="photo-upload" style="pointer-events: none;">
                                <span>+</span>
                            </label>   
                        </div>

                        <div class="photo-upload-container" style="margin-top: 3%;">
                            <span>Добавить фото</span>
                            <div id="error-message" style="color: red;"></div>
                        </div>

                
                        <div class="containerNewProduct" style="margin-top: 3%;">
                            <div class="nameInput">
                                <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                                <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                                <label >Изображение товара</label>
                            </div>
                            <div class="textareaInput" id="photo-preview-container">
                                <div id="photo-previews" class="inputCreateStyle"></div>
                            </div>

                            <div class="nameInput" style="margin-top: 2%;">
                                <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                                <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                                <label >Номер товара</label>
                            </div>
                            <div class="textareaInput">
                                <input name="product_id" class="inputCreateStyle" type="text" value="${product_by_no.id}" placeholder="Введите номер товара" disabled>
                            </div>
                            <div class="textareaInput" style="opacity: 0; height: 1px;">
                                <input id="media_list_container" name="media_list" class="inputCreateStyle" type="text" value="${product_by_no.media_list[0]}" disabled >
                            </div>

                            <div class="nameInput">
                                <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                                <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                                <label >Название</label>
                            </div>
                            <div class="textareaInput">
                                <input name="product_name" class="inputCreateStyle" type="text" value="${product_by_no.name}" required placeholder="Введите название товара">
                            </div>

                            <div style=" max-width: 100%; display: flex; flex-direction: row; justify-content: space-between; margin: 3% 0; align-items:flex-end">
                                <div>
                                    <div class="nameInput">
                                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                                        <label >Цена за штуку</label>
                                    </div>
                                    <div class="textareaInput">
                                        <input name="product_price" min="0" max="100000" style="width: 100%;" class="inputCreateStyleMin" type="number" value="${product_by_no.price / 100}" placeholder="&#8381">
                                    </div>
                                </div>

                                <div>
                                    <div class="nameInput">
                                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                                        <label >Скидка</label>
                                    </div>
                                    <div class="textareaInput">
                                        <input style="width: 100%;" class="inputCreateStyleMin" type="number" name="discount" min="0" max="100" step="1" value="${product_by_no.discount}" placeholder="%">
                                    </div>
                                </div>

                                <div class="totalStyle">Итог: 
                                    <p>
                                        <input class="inpSt" style="width: 60%; border: none;" type="number" name="product_end_price" min="0" step="0.01" value="${(product_by_no.quantity * product_by_no.discount) / 100}" readonly>
                                    </p>
                                </div>
                            </div>

                            <div class="nameInput">
                                <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                                <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                                <label >Количество</label>
                            </div>
                            <div class="textareaInput">
                                <input name="quantity" min="0" max="10000" step="1" class="inputCreateStyle" type="number" id="quantity" value="${product_by_no.quantity}" placeholder="Количество товара">
                            </div>
                            <div style="margin-top: 3%;">
                                <div class="nameInput">
                                    <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="" style="margin-left: 2%">
                                    <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="" style="margin-left: 2%">
                                    <label >Подтверждение менеджера</label>
                                </div>
                                <div class="nameInput">
                                    <input type="checkbox" name="product_requires_manager" ${product_by_no.requires_confirm_menager ? 'checked' : ''}>
                                </div>
                            </div>

                            <div style="margin: 3% 0;">
                                <div class="nameInput">
                                    <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="" style="margin-left: 2%">
                                    <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="" style="margin-left: 2%">
                                    <label >Активен</label>
                                </div>
                                <div class="nameInput">
                                    <input type="checkbox" name="product_activ" ${product_by_no.activ ? 'checked' : ''}>
                                </div>
                            </div>

                            <div style=" max-width: 100%; display: flex; flex-direction: row; justify-content: space-between; margin: 3% 0; align-items:flex-end">
                                <div>
                                    <div class="nameInput">
                                        <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                                        <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                                        <label>Приоритет расположения</label>
                                    </div>
                                    <div class="textareaInput">
                                        <input name="display_priority" min="0" max="100000" style="width: 100%;" class="inputCreateStyleMin" type="number" value="${product_by_no.display_priority}">
                                    </div>
                                </div>
                            </div>

                            <div class="nameInput">
                                <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                                <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                                <label >Описание</label>
                            </div>
                            <div class="textareaInput" style="margin-bottom: 100px;">
                                <textarea name="product_description" class="inputCreateStyle" type="text" required="" placeholder="Введите описание товара" rows="4">${product_by_no.description}</textarea>
                            </div>
                        </div>
                    </form>

                    <div class="fixed_done_manipulator" style="padding-bottom: 4%;">
                        <img width="30px" src="icon/Ellipse 34.png" data-tab="main" class="delete-btn light_theme" alt="" onclick="setMenuDiv('items')">
                        <img width="30px" src="icon_white/Ellipse 34.png" data-tab="main" class="delete-btn dark_theme" alt="" onclick="setMenuDiv('items')">  

                        <button id="save-order-line" class="btn" style="margin: 0; padding: 2% 15%;" >
                            <img width="20px" src="icon/Save file.png" alt="" class="light_theme">
                            <img width="20px" src="icon_white/Save file.png" alt="" class="dark_theme">
                            Сохранить
                        </button>
                      
                        <button type="button" id="delete-order-line" class="btnTransparent">
                            <img width="30px" src="icon/Bin.png" alt="" class="light_theme">
                            <img width="30px" src="icon_white/Bin.png" alt="" class="dark_theme">
                        </button>
                    </div>
                </div>
            </div>
        </div>
            `;
            productInfo.classList.add('order-line');
            cart_item.appendChild(productInfo);

/* вдруг понадобится, как раньше работала подгрузка первых фото
            const photoPreviewsContainer = document.getElementById('photo-previews');

            // Очистить контейнер с превью перед загрузкой новых изображений
            photoPreviewsContainer.innerHTML = '';

            // Перебрать каждое изображение из списка медиа
            product_by_no.media_list.forEach(media => {
                // Создать тег <img> для каждого изображения и добавить его в контейнер с превью
                const img = document.createElement('img');
                img.src = DomainUrl + media; // Путь к изображению
                img.classList.add('previePhoto');
                //img.alt = 'Загрузите изображение товара';
                //img.style.color = '#706f6f';
                //img.style.maxWidth = '200px'; // Максимальная ширина 100 пикселей
                //img.style.maxHeight = '200px'; // Максимальная высота 100 пикселей
                //img.style.width = 'auto'; // Автоматический расчет ширины для сохранения пропорций
                //img.style.height = 'auto'; // Автоматический расчет высоты для сохранения пропорций
                photoPreviewsContainer.appendChild(img);
            });
*/
            
            const photoPreviews = document.getElementById('photo-previews');
            photoPreviews.innerHTML = '';
            // Перебираем все выбранные файлы и добавляем их в formData
            image_div_id = 0;
            imge_prew_len = 0;
            //fileInputs.forEach((fileInput, index) => {
            product_by_no.media_list.forEach(media => {
                //for (const file of fileInput.files) {
                //formData.append('files[]', file);
                const photoPreview = document.createElement('img');
                //photoPreview.src = URL.createObjectURL(file);
                photoPreview.src = DomainUrl + media;
                photoPreview.classList.add('previePhotoMin');
                photoPreview.classList.add('previePhotoOld');
                const media_d = media.split('/');
                photoPreview.setAttribute('data-filename', media_d[media_d.length - 1]);
                //photoPreview.style.maxWidth = '100px';
                //photoPreview.style.maxHeight = '100px';

                // Добавляем кнопку удаления для каждой фотографии
                const deleteButton = document.createElement('button');
                deleteButton.classList.add('btnDelImg');
                deleteButton.textContent = 'Удалить';
                deleteButton.type = 'button';
                deleteButton.id = `deleteButton-${image_div_id}`;

                // Создание кнопки "Вверх"
                const moveUpButton = document.createElement('button');
                moveUpButton.classList.add('btnMoveUp'); // Добавляем класс
                moveUpButton.textContent = '↑'; // Устанавливаем текст кнопки
                moveUpButton.type = 'button'; // Устанавливаем тип кнопки
                moveUpButton.id = `moveUpButton-${image_div_id}`; // Уникальный идентификатор

                // Создание кнопки "Вниз"
                const moveDownButton = document.createElement('button');
                moveDownButton.classList.add('btnMoveDown'); // Добавляем класс
                moveDownButton.textContent = '↓'; // Устанавливаем текст кнопки
                moveDownButton.type = 'button'; // Устанавливаем тип кнопки
                moveDownButton.id = `moveDownButton-${image_div_id}`; // Уникальный идентификатор

                const previewContainer = document.createElement('div');
                previewContainer.classList.add('previePhotoContainer');
                previewContainer.appendChild(photoPreview);
                previewContainer.appendChild(moveUpButton);
                previewContainer.appendChild(moveDownButton);
                previewContainer.appendChild(deleteButton);
                previewContainer.id = 'div-image-item-' + image_div_id;

                photoPreviews.appendChild(previewContainer);

                document.getElementById(`deleteButton-${image_div_id}`).addEventListener('click', function () {
                    const buttonId = event.target.id; // Получаем id кнопки
                    const imageId = buttonId.replace('deleteButton-', 'div-image-item-'); // Преобразуем id кнопки в id блока
                    const div_image_item = document.getElementById(imageId); // Получаем div по id
                    console.log(div_image_item); // Для проверки
                    if (div_image_item) {
                        div_image_item.remove(); // Удаляем div
                    }
                });

                // Обработчик для кнопки "Вверх"
                moveUpButton.addEventListener('click', function () {
                    const prevContainer = previewContainer.previousElementSibling; // Получаем предыдущий контейнер
                    if (prevContainer) {
                        photoPreviews.insertBefore(previewContainer, prevContainer); // Перемещаем текущий контейнер вверх
                    }
                });

                // Обработчик для кнопки "Вниз"
                moveDownButton.addEventListener('click', function () {
                    const nextContainer = previewContainer.nextElementSibling; // Получаем следующий контейнер
                    if (nextContainer) {
                        // Используем insertBefore, чтобы переместить текущий контейнер после следующего
                        photoPreviews.insertBefore(previewContainer, nextContainer.nextSibling); 
                    }
                });


                image_div_id += 1;
                imge_prew_len += 1;
                //}
            });
            // ЗАГРУЗКА ФОТО
            // Функция для обновления превью фотографий
            function updatePhotoPreviews() {
                const photoPreviews = document.getElementById('photo-previews');
                //photoPreviews.innerHTML = '';
                const fileInputs = document.querySelectorAll('input[type="file"]');
                // Перебираем все выбранные файлы и добавляем их в formData
                if (fileInputs.length > 0) {
                    // Находим последний input[type="file"]
                    //const fileInputsId= fileInputs.length - 1
                    const lastFileInput = fileInputs[fileInputs.length - 1];

                    // Проверяем, есть ли файлы в последнем input
                    //if (lastFileInput.files.length > 0) {
                    //lastFileInput.files.forEach(lastFile => {
                    Array.from(lastFileInput.files).forEach(lastFile => {
                        // Очищаем контейнер для превью перед добавлением нового файла
                        //photoPreviews.innerHTML = '';

                        // Берём последний файл из последнего input
                        //const lastFile = lastFileInput.files[lastFileInput.files.length - 1];

                        // Создаём превью для последнего файла
                        const photoPreview = document.createElement('img');
                        photoPreview.src = URL.createObjectURL(lastFile);
                        photoPreview.setAttribute('data-filename', lastFile.name);
                        photoPreview.classList.add('previePhotoMin');

                        // Добавляем кнопку удаления для фотографии
                        const deleteButton = document.createElement('button');
                        deleteButton.classList.add('btnDelImg');
                        deleteButton.textContent = 'Удалить';
                        deleteButton.type = 'button';
                        deleteButton.id = `deleteButton-${image_div_id}`;

                        // Создание кнопки "Вверх"
                        const moveUpButton = document.createElement('button');
                        moveUpButton.classList.add('btnMoveUp'); // Добавляем класс
                        moveUpButton.textContent = '↑'; // Устанавливаем текст кнопки
                        moveUpButton.type = 'button'; // Устанавливаем тип кнопки
                        moveUpButton.id = `moveUpButton-${image_div_id}`; // Уникальный идентификатор

                        // Создание кнопки "Вниз"
                        const moveDownButton = document.createElement('button');
                        moveDownButton.classList.add('btnMoveDown'); // Добавляем класс
                        moveDownButton.textContent = '↓'; // Устанавливаем текст кнопки
                        moveDownButton.type = 'button'; // Устанавливаем тип кнопки
                        moveDownButton.id = `moveDownButton-${image_div_id}`; // Уникальный идентификатор


                        const previewContainer = document.createElement('div');
                        previewContainer.classList.add('previePhotoContainer');
                        previewContainer.appendChild(photoPreview);
                        previewContainer.appendChild(moveUpButton);
                        previewContainer.appendChild(moveDownButton);
                        previewContainer.appendChild(deleteButton);
                        previewContainer.id = 'div-image-item-' + image_div_id;
                        photoPreviews.appendChild(previewContainer);
                                
                        document.getElementById(`deleteButton-${image_div_id}`).addEventListener('click', function (event) {
                            //alert('Удаление 1');
                            //const photoPreview = this.parentNode;
                            const buttonId = event.target.id; // Получаем id кнопки
                            const inputId = imge_prew_len - parseInt(buttonId.replace('deleteButton-', '')) ; // Преобразуем id кнопки в id блока
                            
                            //const div_image_item = document.getElementById(imageId); // Получаем div по id
                            //const fileInputsDel = document.querySelectorAll('input[type="file"]');
                            // Перебираем все выбранные файлы и добавляем их в formData
                            //if (fileInputsDel.length > 0) {
                                // Находим последний input[type="file"]
                            //const fileInputsId= fileInputsDel.length - 1
                            //const lastFileInputDel = lastFile//fileInputsDel[inputId];
                            // Получаем индекс фотографии в списке
                            //const photoPreview = this.parentNode;
                            //const indexToRemove = Array.from(photoPreviews.children).indexOf(photoPreview);
                            //console.log(photoPreviews.children, photoPreview, indexToRemove);

                            //lastFileInputDel.parentNode.removeChild(lastFileInputDel);
                            //}

                            const imageId = buttonId.replace('deleteButton-', 'div-image-item-'); // Преобразуем id кнопки в id блока
                            const div_image_item = document.getElementById(imageId); // Получаем div по id
                            console.log(div_image_item); // Для проверки
                            if (div_image_item) {
                                div_image_item.remove(); // Удаляем div
                            }
                                //updatePhotoPreviews();

                        });

                        // Обработчик для кнопки "Вверх"
                        moveUpButton.addEventListener('click', function () {
                            const prevContainer = previewContainer.previousElementSibling; // Получаем предыдущий контейнер
                            if (prevContainer) {
                                photoPreviews.insertBefore(previewContainer, prevContainer); // Перемещаем текущий контейнер вверх
                            }
                        });

                        // Обработчик для кнопки "Вниз"
                        moveDownButton.addEventListener('click', function () {
                            const nextContainer = previewContainer.nextElementSibling; // Получаем следующий контейнер
                            if (nextContainer) {
                                // Используем insertBefore, чтобы переместить текущий контейнер после следующего
                                photoPreviews.insertBefore(previewContainer, nextContainer.nextSibling); 
                            }
                        });

                        image_div_id += 1;
                    }
                )}
                /*
                const photos = document.getElementById('fileInput_0').files;
                console.log('photos', photos);

                for (let i = 0; i < photos.length; i++) {
                    const photoPreview = document.createElement('img');
                    photoPreview.src = URL.createObjectURL(photos[i]);
                    photoPreview.style.maxWidth = '100px';
                    photoPreview.style.maxHeight = '100px';

                    // Добавляем кнопку удаления для каждой фотографии
                    const deleteButton = document.createElement('button');
                    deleteButton.classList.add('btn');
                    deleteButton.textContent = 'Удалить';
                    deleteButton.type = 'button';
                    deleteButton.id = `deleteButton-${i}`;

                    const previewContainer = document.createElement('div');
                    previewContainer.appendChild(photoPreview);
                    previewContainer.appendChild(deleteButton);
                    photoPreviews.appendChild(previewContainer);
                }
                */
/* с новым блоком фото удалять не надо
                photoPreviews.innerHTML += '<p><span style="color:red;">После сохранения старые фото будут затёрты</span></p>';

                //for (let i = 0; i < photos.length; i++) {

                id_photo = 0;
                fileInputs.forEach((fileInput, index) => {
                    for (const file of fileInput.files) {
                        console.log(`deleteButton-${id_photo}`);
                        document.getElementById(`deleteButton-${id_photo}`).addEventListener('click', function (event) {
                            //alert('Удаление 1');
                            const photoPreview = this.parentNode;

                            // Получаем индекс фотографии в списке
                            const indexToRemove = Array.from(photoPreviews.children).indexOf(photoPreview);
                            console.log(photoPreviews.children, photoPreview, indexToRemove);

                            fileInput.parentNode.removeChild(fileInput);
                            updatePhotoPreviews();

                        });

                        id_photo += 1;
                    }
                });
*/
            }

            function add_input_photo() {
                const photos_div = document.getElementById(`photos_div`);
                var elements = photos_div.getElementsByTagName('*');

                // Пройти по каждому элементу и добавить атрибут disabled
                var last_id = 0;
                for (var i = 0; i < elements.length; i++) {
                    //elements[i].disabled = true;
                    elements[i].style.display = 'none';
                    console.log(elements[i].id);
                    let lastIndex = elements[i].id.lastIndexOf("_"); // Получаем индекс последнего символа "_"
                    last_id = parseInt(elements[i].id.substring(lastIndex + 1)); // Получаем подстроку после последнего "_" и преобразуем ее в число
                }

                var input = document.createElement('input');
                var next_id = last_id + 1;

                // Установка атрибутов для нового элемента input
                input.setAttribute('class', 'active-file');
                input.setAttribute('type', 'file');
                input.setAttribute('name', 'photos_' + next_id);
                input.setAttribute('id', 'fileInput_' + next_id);
                input.setAttribute('data-id', '0');
                input.setAttribute('multiple', '');
                //input.setAttribute('multiple', '');

                // Добавление элемента input на страницу (например, в body)
                document.body.appendChild(input);
                //photos_div.innerHTML += `<input class="active-file" type="file" name="photos_${i}" id="fileInput_${i}" data-id="0" multiple>`
                photos_div.appendChild(input);

                document.getElementById(`fileInput_${next_id}`).addEventListener('change', function (event) {
                    updatePhotoPreviews();
                    add_input_photo();
                });
            }

//* теперь и фото в одном блоке
            // Обновляем превью фотографий при выборе файлов
            document.getElementById('fileInput_0').addEventListener('change', function (event) {
                updatePhotoPreviews();
                add_input_photo();
                //previewContainer.appendChild(photoPreview);
            });
//*/
            /*
            // Обработчик для кнопки сохранения
            document.getElementById('save-order-line').addEventListener('click', function () {
                // Добавьте здесь код для отправки данных формы, например, AJAX запрос
                // Для примера, пока выведите в консоль данные формы
                const formData = new FormData(document.getElementById('form-edit-product'));
                for (const pair of formData.entries()) {
                    console.log(pair[0] + ': ' + pair[1]);
                }
            });
            */


            //cart_item.innerHTML += `<button id="save-order-line" class="btn">СОХРАНИТЬ</button>`;

            document.getElementById('save-order-line').addEventListener('click', async function (event) {
                //event.preventDefault(); 
                await saveProduct(product_no);
                document.getElementById('cart-items').innerHTML = ``;
                await renderProducts();
                reloadImages();
                //setMenuDiv('items');
            });

            document.getElementById(`delete-order-line`).addEventListener('click', async function () {
                let spinner = document.getElementById('modalSpienner');
                spinner.style.display = 'flex';

                try {
                    const response = await fetch(urlTgParams + '/delete_item', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ user_id: tg_id, item_id: product_no})
                    });
                    const data = await response.json();
                    if (data.success) {
                        document.getElementById('cart-items').innerHTML = ``;
                        await renderProducts();
                    }; // Предполагается, что ваш API возвращает массив товаров
                } catch (error) {
                    console.error('Ошибка при удалении товара:', error);
                }
                
                spinner.style.display = 'none';
                setMenuDiv('items');
            });

            const form = document.getElementById('form-edit-product');
            const priceInput = form.querySelector('input[name="product_price"]');
            const discountInput = form.querySelector('input[name="discount"]');
            const endPriceInput = form.querySelector('input[name="product_end_price"]');

            // Функция для обновления итоговой цены
            function updateEndPrice() {
                const price = parseFloat(priceInput.value);
                const discount = parseFloat(discountInput.value);

                endPriceInput.value = getNormalPrice(price, discount); //endPrice.toFixed(2); // Округляем до двух знаков после запятой
            }

            // Обработчики событий для изменения цены и скидки
            priceInput.addEventListener('input', updateEndPrice);
            discountInput.addEventListener('input', updateEndPrice);

            updateEndPrice();

            setMenuDiv('item');
        }

        async function renderProducts() {
            products = await fetchProducts();

            const cart_items_main = document.getElementById('cart-items');
            //cart_items_main.innerHTML = `
            //    <button id="create_product" class="btn">ДОБАВИТЬ НОВЫЙ</button>
            //`; // Очистка содержимого перед добавлением новых товаров

            products.forEach(product => {
                const productElement = document.createElement('div');
                productElement.classList.add('item');
                productElement.setAttribute('id', `product-${product.id}`); // Установка ID для каждой карточки товара
                var price = parseFloat(product.price) / 100;

                let old_price_vivble =  product.discount != 0 

                productElement.innerHTML = `
                    <div class="carousel-container item_image">
                        <button id="prevBtn-${product.id}" class="btnCorusel prevBtn">&#10094;</button>
                        <div id="carousel-slide-${product.id}" class="carousel-slide picture_slide_box">
                            <img style="max-width: 100%; max-height: 100%;" src="${DomainUrl}${product.media_list[0]}" alt="${product.name}" class="carousel-image">
                        </div>
                        <button id="nextBtn-${product.id}" class="btnCorusel nextBtn">&#10095;</button>
                    </div>
                
                    <div class="item_data">
                        <div class="item_meta">
                            <div class="item_prices">
                                <p class="price">${getPriceDec(getNormalPrice(product.price, product.discount))} &#8381;</p>
                                <p class="old_price" style="display: ${old_price_vivble ? 'block' : 'none'};">${getPriceDec(product.price)} &#8381;</p>
                            </div>
                            <div class="item_stock">
                                <span>${product.quantity}</span> шт
                            </div>
                        </div>
                        <p class="item_title">${product.name}</p>
                        <button class="btn addToCart" id="edit-product-${product.id}">
                            <img width="16px" src="icon/edit.png" alt="" class="light_theme">
                            <img width="16px" src="icon_white/edit.png" alt="" class="dark_theme"> 
                            Изменить
                        </button>
                    </div>
                `;

                cart_items_main.appendChild(productElement);

                document.getElementById(`edit-product-${product.id}`).addEventListener('click', async function () {
                    await openEditProductCart(product.id);
                });

                const carouselSlide = document.getElementById(`carousel-slide-${product.id}`);
                const prevBtn = document.getElementById(`prevBtn-${product.id}`);
                const nextBtn = document.getElementById(`nextBtn-${product.id}`);

                let counter = 0;

                // Функция для загрузки изображений в карусель
                function loadImages() {
                    carouselSlide.innerHTML = '';
                    product.media_list.forEach((image, index) => {
                        const img = document.createElement('img');
                        img.src = DomainUrl + image;
                        img.alt = product.name;
                        img.style.maxWidth = '100%';
                        img.style.maxHeight = '100%';
                        img.classList.add('carousel-image');
                        if (index === counter) {
                            img.classList.add('active');
                        }
                        carouselSlide.appendChild(img);
                    });
                }

                // Загрузка изображений при загрузке страницы
                loadImages();

                // Обработчики для кнопок "Предыдущее" и "Следующее"
                prevBtn.addEventListener('click', () => {
                    counter--;
                    if (counter < 0) {
                        counter = product.media_list.length - 1;
                    }
                    slideImage();
                });

                nextBtn.addEventListener('click', () => {
                    counter++;
                    if (counter >= product.media_list.length) {
                        counter = 0;
                    }
                    slideImage();
                });

                // Функция для плавного перемещения изображений
                function slideImage() {
                    const imgWidth = carouselSlide.querySelector('.carousel-image').clientWidth;
                    carouselSlide.style.transform = `translateX(-${counter * imgWidth}px)`;
                }
            });

            document.getElementById(`create_product`).addEventListener('click', async function () {
                await openEditProductCart(0);
            });
        }

        var products;

        renderProducts();
    </script>

    <script>
        // страничка для открытия формы с настройкой параметров сайта
        async function openSettingsSite() {
            const settings_site = await getSettingsSite();

            const cart_setting_site = document.getElementById('cart-setting-site');
            cart_setting_site.innerHTML = '';

            console.log('settings_site.min_amount ---> ', settings_site.min_amount )

            //awaiting_fields_list.forEach(awaiting_field => {
            const setting_SiteInfo = document.createElement('div');
            setting_SiteInfo.innerHTML = `
                <form id="form-settings-site" enctype="multipart/form-data">
                    <div style="margin-bottom: 20px;">
                        <div class="nameInput">
                            <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                            <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                            <label for="min-order">Минимальная сумма заказа</label>
                        </div>
                        <div class="textareaInput">
                            <label for="min-order">Не меньше:</label>
                            <input class="inpSt" type="text" id="min-order" name="min_order" placeholder="&#8381" value="${settings_site.min_amount}" style="width: 40%; padding: 3px 5px; font-size: 13px; border: 1px solid #ccc; border-radius: 4px;" required>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <div class="nameInput">
                            <img class="icon_arrow light_theme_arrow" src="icon/Line 15.png" alt="">
                            <img class="icon_arrow dark_theme_arrow" src="icon_white/Line 15.png" alt="">
                            <label for="payment-token">Токен оплаты</label>
                        </div>
                        <div class="textareaInput">
                            <input class="inpSt" type="text" id="payment-token" name="payment_token"
                                style="width: 91%; padding: 10px; font-size: 13px; border: 1px solid #ccc; border-radius: 4px; color: #acacac;"
                                placeholder="Токен оплаты" value="${settings_site.PAYMENTS_TOKEN}" required>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <div class="nameInput">
                            <img class="icon_arrow" src="icon/Line 15.png" alt="">
                            <label for="privacy-file">Файл с политикой конфиденциальности</label>
                        </div>
                        <div class="textareaInput">
                            <input type="file" id="privacy-file" name="privacy_file">
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <div class="nameInput">
                            <img class="icon_arrow" src="icon/Line 15.png" alt="">
                            <label for="rules-file">Файл с правилами акции</label>
                        </div>
                        <div class="textareaInput">
                            <input type="file" id="rules-file" name="rules_file">
                        </div>
                    </div>

                    <div class="fixed_done_manipulator" style="padding-bottom: 4%;">
                    <img style="margin-left: 6%;" width="30px" src="icon/Ellipse 34.png" class="back___btn light_theme" alt="" onclick="setMenuDiv('settings')">
                    <img style="margin-left: 6%;" width="30px" src="icon_white/Ellipse 34.png" class="back___btn dark_theme" alt="" onclick="setMenuDiv('settings')">

                    <button type="button" id="save-settings-site" class="btn" style="margin: 0; padding: 2% 15%;" >
                        <img width="20px" src="icon/Save file.png" alt="" class="light_theme">
                        <img width="20px" src="icon_white/Save file.png" alt="" class="dark_theme">
                        Сохранить
                    </button>

                    <img width="30px" style="opacity: 0;" src="icon/Group 46.png" alt="" class="right_arrow_btn">
                </div>
                </form>
            `;
            cart_setting_site.appendChild(setting_SiteInfo);

            document.getElementById('save-settings-site').addEventListener('click', async function () {
                await updateSettingsSite();
                setMenuDiv('settings');
            });

            setMenuDiv('settings-site');
        }

        async function getSettingsSite() {
            try {
                const response = await fetch(urlTgParams + '/get_settings_site_all', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_id: tg_id })
                });
                const data = await response.json();
                console.log('getSettingsSite() -- > data.settings_site -->', data.settings_site)
                return data.settings_site; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных о товарах:', error);
                return [];
            }
        }

        async function updateSettingsSite() {
            var form_settings_site = document.getElementById('form-settings-site');
            var formData = new FormData(form_settings_site);
            formData.append('user_id', tg_id);

            try {
                const response = await fetch(urlTgParams + '/update_settings_site', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                return data.success; // Предполагается, что ваш API возвращает массив товаров
            } catch (error) {
                console.error('Ошибка при получении данных о товарах:', error);
                return [];
            }
        }

        ////добавление менеджера модалка
        //const addManagerButton = document.getElementById('add-manager-button');
        //const addManagerForm = document.getElementById('add-manager-form');
        //const cancelButton = document.getElementById('cancel');
        //
        //addManagerButton.addEventListener('click', () => {
        //    addManagerForm.style.display = 'flex';
        //});
        //
        //cancelButton.addEventListener('click', () => {
        //    addManagerForm.style.display = 'none';
        //});
    </script>
</body>

</html>